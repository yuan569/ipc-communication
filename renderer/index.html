<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>IPC Bus Demo</title>
    <!-- Strict CSP: no inline scripts; JS must be loaded from files -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; connect-src 'self' data:; img-src 'self' data:;">
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="container">
      <h1>IPC Bus Demo <span class="badge">Electron • IPC • Demo</span></h1>

      <div class="grid">
        <!-- Inputs -->
        <section class="card panel" style="grid-column: span 12">
          <div class="section-title">
            <h3>Inputs</h3>
            <span class="section-desc">示例通用输入：消息文本、来电人、工单号</span>
          </div>
          <div class="row">
            <label>Message:<br/><input id="msg-input" type="text" placeholder="hello" /></label>
            <label>Caller:<br/><input id="caller-input" type="text" placeholder="10086" /></label>
            <label>TicketId:<br/><input id="ticket-input" type="text" placeholder="T-001" /></label>
          </div>
        </section>

        <!-- One-way (emit + ack) -->
        <section class="card panel oneway" style="grid-column: span 6">
          <div class="section-title">
            <h3>单向通信（One-way）</h3>
            <span class="badge">Renderer → Main</span>
          </div>
          <div class="section-desc">仅发送到主进程，不分发到窗口；或发送并仅获取分发确认（ACK）。</div>
          <div class="row">
            <button id="btn-emit-log-oneway" class="btn info">Emit one-way LOG</button>
            <button id="btn-ack" class="btn primary">ACK: send PING</button>
          </div>
        </section>

        <!-- Request-Response -->
        <section class="card panel rr" style="grid-column: span 6">
          <div class="section-title">
            <h3>请求-响应（Request-Response）</h3>
            <span class="badge">Renderer ↔ Renderer/Main</span>
          </div>
          <div class="section-desc">发送请求并等待 replyTo 响应。此示例由渲染端自动响应 PING → PONG。</div>
          <div class="row">
            <button id="btn-rr" class="btn primary">Request PING (5s timeout)</button>
          </div>
        </section>

        <!-- Broadcast / Targeted -->
        <section class="card panel broadcast" style="grid-column: span 6">
          <div class="section-title">
            <h3>广播 / 定向</h3>
            <span class="badge">Renderer → All / workbench</span>
          </div>
          <div class="section-desc">广播到所有窗口，或按目标窗口名定向发送。</div>
          <div class="row">
            <button id="btn-broadcast" class="btn success">Broadcast BROADCAST</button>
            <button id="btn-emit-callstart" class="btn ghost">Emit CALL_START → workbench</button>
          </div>
        </section>

        <!-- Subscribe / Unsubscribe -->
        <section class="card panel subscribe" style="grid-column: span 6">
          <div class="section-title">
            <h3>订阅 / 取消订阅</h3>
            <span class="badge">Renderer-side filter</span>
          </div>
          <div class="section-desc">控制是否在渲染端打印 CALL_START 事件（本地过滤示例）。</div>
          <div class="row">
            <button id="btn-sub-callstart" class="btn warning">Subscribe CALL_START</button>
            <button id="btn-unsub-callstart" class="btn ghost">Unsubscribe CALL_START</button>
          </div>
        </section>

        <!-- Main → Renderer push -->
        <section class="card panel push" style="grid-column: span 12">
          <div class="section-title">
            <h3>主进程主动推送（Main → Renderer）</h3>
            <span class="badge">Main → workbench</span>
          </div>
          <div class="section-desc">请求主进程向本窗口推送 SERVER_PUSH（主进程收到 REQ_MAIN_PUSH 后触发）。</div>
          <div class="row">
            <button id="btn-req-main-push" class="btn danger">Request main to push SERVER_PUSH</button>
          </div>
        </section>

        <!-- Logs -->
        <section class="card panel logs" style="grid-column: span 12">
          <div class="section-title">
            <h3>Logs</h3>
            <div class="row">
              <button id="btn-clear" class="btn ghost">Clear</button>
            </div>
          </div>
          <pre id="log" class="log"></pre>
          <div class="footer">Tip: 打开 DevTools 查看完整事件对象与主进程日志输出。</div>
        </section>
      </div>
    </div>

    <!-- UMD SDK for browser usage -->
    <script src="../dist-umd/event-bus-client.js"></script>
    <script src="./renderer.js"></script>
  </body>
</html>
